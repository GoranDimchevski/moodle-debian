#! /bin/sh /usr/share/dpatch/dpatch-run
## CVE-2007-3215_phpmailer.dpatch by Francois Marier <francois@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Security fix for improperly escaped shell command and params in phpmailer

@DPATCH@
diff -Nru moodle-1.8.2/lib/phpmailer/class.phpmailer.php moodle-1.8.2.dfsg/lib/phpmailer/class.phpmailer.php
--- moodle-1.8.2/lib/phpmailer/class.phpmailer.php	2007-03-12 19:26:25.000000000 -0700
+++ moodle-1.8.2.dfsg/lib/phpmailer/class.phpmailer.php	2009-02-12 11:09:06.000000000 -0800
@@ -404,9 +404,9 @@
      */
     function SendmailSend($header, $body) {
         if ($this->Sender != "")
-            $sendmail = sprintf("%s -oi -f %s -t", $this->Sendmail, $this->Sender);
+            $sendmail = sprintf("%s -oi -f %s -t", escapeshellcmd($this->Sendmail), escapeshellarg($this->Sender));
         else
-            $sendmail = sprintf("%s -oi -t", $this->Sendmail);
+            $sendmail = sprintf("%s -oi -t", escapeshellcmd($this->Sendmail));
 
         if(!@$mail = popen($sendmail, "w"))
         {
